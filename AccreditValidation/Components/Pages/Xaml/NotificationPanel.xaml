<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:notification="clr-namespace:AccreditValidation.Shared.Services.Notification;assembly=AccreditValidation.Shared"
             xmlns:converters="clr-namespace:AccreditValidation.Components.Converters"
             x:Class="AccreditValidation.Components.Pages.Xaml.NotificationPanel"
             x:Name="this"
             WidthRequest="350"
             HeightRequest="500">

    <ContentView.Resources>
        <ResourceDictionary>
            <converters:InverseBoolConverter x:Key="InverseBoolConverter"/>
        </ResourceDictionary>
    </ContentView.Resources>

    <Frame 
        BackgroundColor="White"
        CornerRadius="10"
        HasShadow="True"
        Padding="0">

        <Grid RowDefinitions="Auto,*,Auto">

            <!-- Header -->
            <Grid Grid.Row="0" 
                  BackgroundColor="LightGray"
                  Padding="15,10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Label 
                    Grid.Column="0"
                    Text="Notifications"
                    FontSize="18"
                    FontAttributes="Bold"
                    VerticalOptions="Center"/>

                <Button 
                    Grid.Column="1"
                    Text="✕"
                    BackgroundColor="Transparent"
                    Clicked="OnCloseClicked"
                    WidthRequest="30"
                    HeightRequest="30"/>
            </Grid>

            <!-- Notifications List -->
            <CollectionView 
                Grid.Row="1"
                ItemsSource="{Binding Notifications, Source={x:Reference this}}"
                SelectionMode="None">

                <CollectionView.EmptyView>
                    <StackLayout 
                        Padding="20"
                        VerticalOptions="Center"
                        HorizontalOptions="Center">
                        <Label 
                            Text="No notifications"
                            FontSize="16"
                            TextColor="Gray"
                            HorizontalTextAlignment="Center"/>
                    </StackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="notification:InAppNotificationModel">
                        <Frame 
                            Padding="10"
                            Margin="10,5"
                            CornerRadius="5"
                            HasShadow="False"
                            BackgroundColor="{Binding IsRead, Converter={StaticResource InverseBoolConverter}}">

                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer 
                                    Tapped="OnNotificationTapped"
                                    CommandParameter="{Binding .}"/>
                            </Frame.GestureRecognizers>

                            <Grid ColumnDefinitions="Auto,*" 
                                  RowDefinitions="Auto,Auto,Auto"
                                  ColumnSpacing="10">

                                <!-- Type Icon -->
                                <Frame 
                                    Grid.Column="0"
                                    Grid.RowSpan="3"
                                    WidthRequest="40"
                                    HeightRequest="40"
                                    CornerRadius="20"
                                    Padding="0"
                                    HasShadow="False"
                                    BackgroundColor="{Binding TypeColor}"
                                    VerticalOptions="Start">
                                    <Label 
                                        Text="{Binding TypeIcon}"
                                        FontSize="20"
                                        TextColor="White"
                                        HorizontalTextAlignment="Center"
                                        VerticalTextAlignment="Center"/>
                                </Frame>

                                <!-- Title -->
                                <Label 
                                    Grid.Column="1"
                                    Grid.Row="0"
                                    Text="{Binding Title}"
                                    FontSize="14"
                                    FontAttributes="Bold"
                                    LineBreakMode="WordWrap"/>

                                <!-- Message -->
                                <Label 
                                    Grid.Column="1"
                                    Grid.Row="1"
                                    Text="{Binding Message}"
                                    FontSize="12"
                                    TextColor="Gray"
                                    LineBreakMode="WordWrap"
                                    MaxLines="2"/>

                                <!-- Timestamp -->
                                <Label 
                                    Grid.Column="1"
                                    Grid.Row="2"
                                    Text="{Binding TimeAgo}"
                                    FontSize="10"
                                    TextColor="LightGray"
                                    Margin="0,5,0,0"/>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Footer Actions -->
            <Grid 
                Grid.Row="2"
                BackgroundColor="WhiteSmoke"
                Padding="10"
                ColumnDefinitions="*,*"
                ColumnSpacing="10"
                IsVisible="{Binding HasNotifications, Source={x:Reference this}}">

                <Button 
                    Grid.Column="0"
                    Text="Mark All Read"
                    BackgroundColor="LightBlue"
                    TextColor="Black"
                    FontSize="12"
                    Clicked="OnMarkAllReadClicked"/>

                <Button 
                    Grid.Column="1"
                    Text="Clear All"
                    BackgroundColor="LightCoral"
                    TextColor="White"
                    FontSize="12"
                    Clicked="OnClearAllClicked"/>
            </Grid>

        </Grid>
    </Frame>

</ContentView>